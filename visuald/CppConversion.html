
<!DOCTYPE html>
<html lang="en-US">
<!--
    Copyright (c) 1999-2016 by Digital Mars
    All Rights Reserved Written by Walter Bright
    http://digitalmars.com
  -->
<head>
<meta charset="utf-8">
<meta name="keywords" content="D programming language">
<meta name="description" content="D Programming Language">
<title>C++ Conversion Wizard - D Programming Language</title>

<link rel="stylesheet" href="http://www.dlang.org/css/codemirror.css">
<link rel="stylesheet" href="http://www.dlang.org/css/style.css">
<link rel="stylesheet" href="http://www.dlang.org/css/print.css" media="print">
<link rel="shortcut icon" href="http://www.dlang.org/favicon.ico">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.1, maximum-scale=10.0">

</head>
<body id='C++ Conversion Wizard' class='visuald'>
<script type="text/javascript">document.body.className += ' have-javascript'</script>
<div id="top"><div class="helper"><div class="helper expand-container">    <div class="logo"><a href="http://www.dlang.org"><img id="logo" alt="D Logo" src="http://www.dlang.org/images/dlogo.svg"></a></div>
    <a href="http://www.dlang.org/menu.html" title="Menu" class="hamburger expand-toggle"><span>Menu</span></a>
    
<div id="cssmenu"><ul>    <li><a href='http://tour.dlang.org'><span>Learn</span></a></li>
    <li class='expand-container'><a class='expand-toggle' href='http://www.dlang.org/documentation.html'><span>Documentation</span></a>
      
<ul class='expand-content'><li><a href='    http://www.dlang.org/spec/spec.html'>Language Reference</a></li><li><a href='    http://www.dlang.org/phobos/index.html'>Library Reference</a></li><li><a href='    http://www.dlang.org/library/index.html'>NEW Library Reference Preview</a></li><li><a href='    http://www.dlang.org/comparison.html'>Feature Overview</a></li><li><a href='    http://www.dlang.org/dmd-windows.html'>DMD Manual</a></li><li><a href='    http://www.dlang.org/articles.html'>Articles
</a></li></ul></li>
    <li><a href='http://www.dlang.org/download.html'><span>Downloads</span></a></li>
    <li><a href='https://code.dlang.org'><span>Packages</span></a></li>
    <li class='expand-container'><a class='expand-toggle' href='http://www.dlang.org/community.html'><span>Community</span></a>
      
<ul class='expand-content'><li><a href='    http://www.dlang.org/bugstats.php'>Bug Tracker</a></li><li><a href='    https://dlang.org/blog'>Blog</a></li><li><a href='    https://forum.dlang.org'>Forums</a></li><li><a href='    irc://irc.freenode.net/d'>IRC</a></li><li><a href='    https://github.com/dlang'>D on GitHub</a></li><li><a href='    https://wiki.dlang.org'>Wiki</a></li><li><a href='    https://twitter.com/search?q=%23dlang'>Twitter</a></li></ul></li>
    <li class='expand-container'><a class='expand-toggle' href='http://www.dlang.org/resources.html'><span>Resources</span></a>
      
<ul class='expand-content'><li><a href='    http://www.dlang.org/tools.html'>D-Specific Tools</a></li><li><a href='    http://rainers.github.io/visuald/visuald/StartPage.html'>Visual D</a></li><li><a href='    https://wiki.dlang.org/Editors'>Editors</a></li><li><a href='    https://wiki.dlang.org/IDEs'>IDEs</a></li><li><a href='    https://wiki.dlang.org/Tutorials'>Tutorials</a></li><li><a href='    https://wiki.dlang.org/Books'>Books</a></li><li><a href='    http://www.dlang.org/dstyle.html'>The D Style</a></li><li><a href='    http://www.dlang.org/glossary.html'>Glossary</a></li><li><a href='    http://www.dlang.org/acknowledgements.html'>Acknowledgments</a></li><li><a href='    http://www.dlang.org/sitemap.html'>Sitemap
</a></li></ul></li>
</ul></div>
    <div class="search-container expand-container">        <a href="http://www.dlang.org/search.html" class="expand-toggle" title="Search"><span>Search</span></a>
        
    <div id="search-box">        <form method="get" action="https://google.com/search">
            <input type="hidden" id="domains" name="domains" value="dlang.org">
            <input type="hidden" id="sourceid" name="sourceid" value="google-search">
            <span id="search-query"><input id="q" name="q" placeholder="Search"></span><span id="search-dropdown"><span class="helper">                <select id="sitesearch" name="sitesearch" size="1">
                    <option value="dlang.org">Entire Site</option>
                    <option  value="dlang.org/spec">Language</option>
                    <option  value="dlang.org/phobos">Library</option>
                    <option  value="forum.dlang.org">Forums</option>
                    
                </select>
            </span></span><span id="search-submit"><button type="submit"><i class="fa fa-search"></i><span>go</span></button></span>
        </form>
    </div>
    </div>
</div></div></div>

<div class="container">    <div class="subnav-helper"></div> <div class="subnav">    
    <div class="head">        <h2>Visual D 0.3.43</h2>
        <p class="subnav-duplicate">            <a href="StartPage.html">Home</a></p>
    </div>
    <ul>        <li><a href='StartPage.html'><span>Home</span></a></li>
        <li><a href='https://github.com/dlang/visuald/releases'><span>Downloads</span></a></li>
        <li><a href='Installation.html'><span>Installation</span></a></li>
        <li class='expand-container open'><a class='expand-toggle' href='#'><span>Tour</span></a>
        <ul class='expand-content'><li><a href='            Features.html'>Feature List</a></li><li><a href='            GlobalOptions.html'>Global Options</a></li><li><a href='            ProjectWizard.html'>Project Wizard</a></li><li><a href='            Editor.html'>Editor</a></li><li><a href='            Search.html'>Search Window</a></li><li><a href='            TokenReplace.html'>Token Replace</a></li><li><a href='            ProjectConfig.html'>Project Config</a></li><li><a href='            CppConversion.html'>C++ to D</a></li><li><a href='            Debugging.html'>Debugging</a></li><li><a href='            CompileCommands.html'>Compile Commands</a></li><li><a href='            Profiling.html'>Profiling</a></li><li><a href='            Coverage.html'>Code Coverage</a></li><li><a href='            DustMite.html'>DustMite Integration</a></li><li><a href='            BrowseInfo.html'>Browse Info
        </a></li></ul></li>
        <li><a href='VersionHistory.html'><span>Version History</span></a></li>
        <li><a href='KnownIssues.html'><span>Known Issues</span></a></li>
        <li><a href='BuildFromSource.html'><span>Building from Source</span></a></li>
    </ul>
</div>
    <div class="hyphenate" id="content">        
<div id="tools"><div >	<div class="tip smallprint">		<a href="https://issues.dlang.org/enter_bug.cgi?bug_file_loc=http%3A%2F%2Fdlang.org/&amp;bug_severity=enhancement&amp;component=visuald&amp;op_sys=All&amp;priority=P3&amp;product=D&amp;rep_platform=All&amp;short_desc=%5BC++ Conversion Wizard%5D&amp;version=D2">Report a bug</a>
		<div >			If you spot a problem with this page, click here to create a Bugzilla issue.
		</div>
	</div>
	<div class="tip smallprint">		<a href="https://github.com/dlang/visuald/edit/master/CppConversion.dd">Improve this page</a>
		<div >			Quickly fork, edit online, and submit a pull request for this page.
			Requires a signed-in GitHub account. This works well for small changes.
			If you'd like to make larger changes you may want to consider using
			a local clone.
		</div>
	</div>
</div></div>
        <h1>C++ Conversion Wizard</h1>
        
        

<p>Visual D can help you converting your C++ code base to D. Even though it is 
capable of some quite extensive reorganization of the code, don't expect to get 
compilable and runnable code out of the box. Helping the converter with additional
replacement rules and manual additional editing of the result might be necessary. 
</p>

<p>The conversion consists of a number of steps:</p>
<ul>
    <li>convert text into a stream of tokens with preceding white space or comments</li>
    <li>convert/expand preprocessor directives, so that the text is no longer a mixture 
	  of two languages. Conditionals are replaced by constructs that should fit into a 
	  tree hierarchy similar to "static if" in D.</li>
    <li>apply user specified replacement rules (pre)</li>
    <li>parse the text with a (slightly sloppy) C++ parser into a syntax tree</li>
    <li>perform a number of transformations on the tree</li>
    <li>apply user specified replacement rules (post)</li>
    <li>write output including adding a prefix to D keywords that are not C++ keywords</li>
</ul>

<p>You can invoke the C++ conversion wizard from the Visual D menu.</p>

<div align="center"><img src="images/cppwizard.png" /></div>

<p>Options:</p>
<ul>
    <li>Convert: Input files/Current document/Current selection. When selecting 
	  "Input files", a whole source code base can be converted, writing files to 
	  the output directory. Otherwise, the text in the editor is replaced. If you
	  have not changed the text and selection after the last conversion, redoing 
	  the conversion will use the initial code to better allow tweaking options.</li>

    <li>Input dir: base directory of input file specifications</li>
    <li>Files and directories: filename pattern to include into conversion, prefix 
	  with '+' to recurse into subdirectories, prefix with '-' to exclude files from
	  the list of files specified so far.</li>
    <li>Source code header: header to write into output files. The identifier 
	  MODULENAME is replaced with the module name of the generated D file. If it
	  is not specified in the header, a module statement will be prepended to it.</li>
    <li>Output dir: the directory where to write output files to.</li>
    <li>Write intermediate files: To debug problems during the conversion, 
	  intermediate files can be written to sub directories "pass1" (after the 
	  proprocessor handling) and "pass2" (after the code reorganization, but 
	  before the final replacements).</li>
    <li>Preprocessor expansions: only the preprocessor identifiers given here 
	  will be expanded. All other preprocessor directives are translated to 
	  corresponding D code. If no assignment is given, the first definition within 
	  the input source code is used. If preprocessor conditionals are expanded, only 
	  the active code path is written to the output file.</li>
    <li>Version conditionals: normally, preprocessor conditionals are translated 
	  to "static if" conditions, but if an identifier is specified here, version 
	  conditionals are used.</li>
    <li>Pre and post token replacements: some constructs are not parsable or 
	  don't convert well. With the token replacements you can inject some replacement 
	  rules into the conversion process. The replacement follows the <a href="TokenReplace.html">
	  Token Search and Replace</a> functionality. The syntax of the rule is
	 <pre>[filename-pattern::] search-pattern =&gt; replacement </pre>
	 If you want to span the rule across multiple lines, use the \ line splicing mechanism.
	</li>
    <li>Value/reference types: sometimes the parser or the converter stumbles across 
	  unknown identifiers that might be types. You can help it specifying them here.
	  Value or reference semantics determine whether an indirection is removed from
	  pointer declarations.</li>
    <li>Keyword prefix: identifiers that are keywords in D, but not in C++, are 
	  prefixed with the given text.</li>
    <li>Package prefix: module names are prefixed with the given package identifier</li>
    <li>Load/Save: save and restore the current dialog settings</li>
    <li>Convert: start the conversion</li>
</ul>

<p>When using the converter on the current selection (there is also a command 
VisualD.ConvertSelection that you can assign to a keyboard shortcut) you should 
select complete declarations, e.g. variable or class declarations and functions. 
Otherwise the parser will stumble.</p>

<p>This tool is the result of generalizing an attempt to convert the dmd front 
end code to D, so please don't be surprised to find some unexpected special casings 
from time to time. The result of that attempt was that the converted code was 
parsable, but did not pass all semantic stages.</p>

<h2>Running from the console</h2>

<p>There is also a command line version of this wizard available 
in the downloads folder: 
<a href="http://www.dsource.org/projects/visuald/browser/downloads/cpp2d.exe?format=raw">cpp2d.exe</a></p>

<p>You can pass a config file to the converter that has been saved by the wizard dialog.
<pre>cpp2d -config myoptions.c2d [files-specs...]</pre>
If you pass files to the program, file specifications in the configuration file are ignored.</p>

<p>See <a href="http://www.dsource.org/projects/visuald/browser/trunk/c2d/dmd.c2d">here</a> 
for an example of a configuration file to get started on converting the dmd front end.</p>

<h2>Examples</h2>

<p>Here are some examples of what the converter can do for you:</p>

Move member and field implementation into class declaration.

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">

class C {
  // comments are usually kept
  static int x;
  DECL *foo(int flags = 0);
};
int C::x = 3;
// moved with the implementation
DECL *C::foo(int flags) { return NULL; }

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

struct C {
  // comments are usually kept
  static int x = 3;
  // moved with the implementation
 DECL *foo(int flags = 0) { return null; }
};

</pre></td></tr>
</table>
</div>


Convert constructor and call super constructor

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">

struct A : B {
    A() : B(1) { }
    A(int x) : B(x) { }
};

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

class A : B {
    this() { super(1); }
    this(int x) { super(x); }
};

</pre></td></tr>
</table>
</div>

Split declarations for variables with different types

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">

int a = sizeof(void *);
int x, *y = (int*)null;

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

int a = (void *).sizeof;
int x;
int *y = cast(int *)null;

</pre></td></tr>
</table>
</div>

Add enumerator type to constants of named enumerator values

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">

typedef enum { e1, e2 } EX;
enum ENUM { kEnum };
int foo() {
    Ident id = (op == kEnum) ? 0 : 1;
}

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

 enum unnamed_1 { e1, e2 }alias unnamed_1 EX;
enum ENUM { kEnum };
int foo() {
    Ident id = (op == ENUM.kEnum) ? 0 : 1;
}

</pre></td></tr>
</table>
</div>

Simple template translations

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">

template&lt;typename TYPE&gt;
struct ArrayBase : Array { 
    TYPE* data;
};
template&lt;typename S, class T&gt;
double foo(S s, T t) { return s+t; }

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

class ArrayBase( TYPE) : Array { 
    TYPE* data;
};

double foo( S, T)(S s, T t) { return s+t; }

</pre></td></tr>
</table>
</div>

Preprocessor macros are converted to enum, alias or templates

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">

#define K1 1 // keep comment
#define K2 (K1+K1)
#define K3 K1
#define SQR(n) (n)*(n)

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

enum K1 =  1; // keep comment
enum K2 =  (K1+K1);
alias K3 K1;
 auto SQR( ARG1 )(ARG1 n) { return  n*n; }

</pre></td></tr>
</table>
</div>

Preprocessor conditionals are converted to static if or can be removed when specified in the "expansions" field

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">

#define ABC 1
  a = 1;
#if ABC
  b = 2;
#endif
  c = 3;

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

enum ABC = 1;
  a = 1;
static if(ABC) {
  b = 2;
}
  c = 3;

</pre></td></tr>
</table>
</div>


It can deal with a number of complicated uses of preprocessor conditionals, but they can get much more difficult to read.

<div align="center">
<table width="90%" style="border: 1px solid #ccc;margin: 0 0 0em 0em;" bgcolor="#F0F0F0">
<tr bgcolor="#C0C0C0"><th>C++</th><th>D</th></tr>
<tr><td width="45%" bgcolor="#FFF0F0"><pre style="background-color: #FFF0F0; border: 0px;margin: 0 0 0em 0em;">

void foo(x) {
  if (x)
    c = 0;
#if COND1 // comment
  else if (a)
#elif COND2
  else if (b)
#endif
    c = 1;
}

</pre></td><td width="45%" bgcolor="#F0F0FF"><pre style="background-color: #F0F0FF; border: 0px;margin: 0 0 0em 0em;">

void foo(x) {
  if (x)
    c = 0;
else if(true) static if(COND1) // comment
  /*else*/ if (a)
goto L_T4; else goto L_F4; else static if(COND2)
  /*else*/ if (b)
goto L_T4; else goto L_F4; else goto L_T4; else L_F4: if(0) L_T4:
    c = 1;
}

</pre></td></tr>
</table>
</div>


        <div class="smallprint" id="copyright">Copyright &copy; 1999-2016 by the <a href="http://www.dlang.org/foundation.html">D Language Foundation</a> | Page generated by
<a href="http://www.dlang.org/spec/ddoc.html">Ddoc</a> on Sun Jun 05 10:00:07 2016
</div>
    </div>
</div>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript">window.jQuery || document.write('\x3Cscript src="http://www.dlang.org/js/jquery-1.7.2.min.js">\x3C/script>');</script>
    <script type="text/javascript" src="http://www.dlang.org/js/dlang.js"></script>
    
    <script type="text/javascript" src="http://www.dlang.org/js/codemirror-compressed.js"></script>
    <script type="text/javascript" src="http://www.dlang.org/js/run.js"></script>

<script type="text/javascript" src="js/run-main-website.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
</body>
</html>
